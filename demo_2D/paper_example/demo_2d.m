figure(9999);clf;hold on
pcircle(-4,5,2,'k');
pcircle(0,-5,2,'k');
pcircle(5,0,2,'k');
%%
pvar x1 x2 u htol epsi;
x = [x1;x2];
%%
dom1 = 12; domain1 = [-dom1 dom1 -dom1 dom1];
dom2 = 3; domain2 = [-dom2 dom2 -dom2 dom2];
%%%%%%%%%%%%%%%%%%%%%%%
C1 = (x1+4)^2+(x2-5)^2-4;
C2 = (x1+0)^2+(x2+5)^2-4;
C3 = (x1-5)^2+(x2-0)^2-4;
[~,h20] = pcontour(C1,0,domain1,'k'); hold on; h20.LineStyle = '--';     
[~,h21] = pcontour(C2,0,domain1,'k'); hold on; h21.LineStyle = '--';   
[~,h22] = pcontour(C3,0,domain1,'k'); hold on; h22.LineStyle = '--';  
%% Without Controller
% B_no_controller = -0.01730994859216674*x1^4+0.01942272684429362*x1^3*x2+0.03417833273172551*x1^2*x2^2-0.03089576272906369*x1*x2^3-0.03229854756848641*x2^4+0.0469049245134507*x1^3-0.02724130274950444*x1^2*x2-0.1920732549990291*x1*x2^2-0.04355589754110674*x2^3-0.1908212359824433*x1^2+0.04850161666128519*x1*x2-0.3902288519748806*x2^2+0.02342000091755831*x1+0.01847082505198164*x2+0.1049276784359924;
% [~,h28]=pcontour(B_no_controller,0,domain2,'r'); hold on; h28.LineStyle = '-'; h28.LineWidth = 1.4;
%% With controller
V1 = 1*x1^4+1*x1^3*x2+1*x1^2*x2^2+1*x1*x2^3+1*x2^4+1*x1^3+1*x1^2*x2+1*x1*x2^2+1*x2^3+1*x1^2+1*x1*x2+1*x2^2+1*x1+1*x2+1;
sub_level_with_controller = 57.23191152365694;
sublevel_C0 = 2;
B_controller_1 = 205.39988836883230760577134788036*x1^2*x2^2 - 15.733076483919825605539699608926*x2 - 32.343368076002114719358360162005*x1 - 16.702690567188692938316307845525*x1*x2 + 58.06348388736881105387510615401*x1*x2^2 - 0.88882356086419722629443640471436*x1^2*x2 + 27.919011189967342545514839002863*x1*x2^3 + 2.3432143317831926054850555374287*x1^3*x2 - 16.00443066513419054786027118098*x1^2 - 4.0245318441951161148040227999445*x1^3 + 21.787467874077073304306395584717*x2^2 - 119.2190088341546641004242701456*x1^4 + 0.47139802020367055357397134685016*x2^3 - 139.72095091473158845474245026708*x2^4 + 10005.142017583266351721249520779;
%% Fin optimal Lyapunov
optimal_Lya = 0.27761530973907616592910585495702*x1 + 0.28916923872954758412134879108635*x2 - 0.097197146692290778413614305009105*x1^2*x2^2 + 0.16409346533219781871792974925484*x1*x2 - 0.0067107957184185072774251779037513*x1*x2^2 + 0.0039474994197178196742026301535589*x1^2*x2 - 0.014031494938999576269078595203155*x1*x2^3 - 0.00061930885322093666596476868591026*x1^3*x2 + 0.23174538663646407354868017591798*x1^2 - 0.0040444947534192298224664519068483*x1^3 + 0.24289451203744766294434498377086*x2^2 + 0.056072867694129807647485108645924*x1^4 - 0.0014805460738564312894033347944855*x2^3 + 0.066405746174927976488433500890096*x2^4 + 9.4479264108289715551336485077627;
optimal_Lya_sub_level_with_controller = 16.18343934060665;
B_controller_2 = 2.2792150898493392929822221049108*x1^2*x2^2 - 0.41437457553024537038055541415815*x2 - 0.592460004295849884670133178588*x1 - 0.72878550175106160402549448917853*x1*x2 + 0.32657438184821629967302669683704*x1*x2^2 - 0.12311335926509317517663077978796*x1^2*x2 + 0.38857703926226566659707373219135*x1*x2^3 + 0.065531224604085058782487749340362*x1^3*x2 - 0.27274445501183336437733828461205*x1^2 + 0.051676281625681295961438621588968*x1^3 + 0.064540293159253261934260592624923*x2^2 - 1.2575947826822169162142017739825*x1^4 + 0.051976655580885905427734883232915*x2^3 - 1.5100706411638649129258737957571*x2^4 + 104.6280122206704561449441825971;
%%
[~,h30]=pcontour(V1,double(sub_level_with_controller),domain1,'m'); hold on; h30.LineStyle = '--'; h30.LineWidth = 1.4;
[~,h32]=pcontour(V1,double(sublevel_C0),domain1,'m'); hold on; h32.LineStyle = '-.'; h32.LineWidth = 1.4;
[~,h33]=pcontour(optimal_Lya,optimal_Lya_sub_level_with_controller,domain1,'m'); h33.LineStyle = '-'; h33.LineWidth = 1.8;
%%
[~,h31]=pcontour(B_controller_1,0,domain1,'g'); hold on; h31.LineStyle = '-.'; h31.LineWidth = 2.5;
[~,h34]=pcontour(B_controller_2,0,domain1,'b'); h34.LineStyle = '-'; h34.LineWidth = 2.5;
%%
h = legend([h22,h32,h30,h33,h31,h34],{'Unsafe Regions','CLF $c_0$','CLF $c^*$','Optimal CLF','CBF','Optimal CBF'}, 'Interpreter','latex','location','northeast','Fontsize',12);
set(h,'FontName','Times New Roman','FontSize',14,'FontWeight','normal');hold on;
set(gca,'ytick',[-10,-5,0,5,10]);
set(gca,'xtick',[-10,-5,0,5,10]);
set(gca,'FontSize',14,'Fontname','Times');
set(gca,'Box','on');
ax = gca;
ax.BoxStyle = 'full';
ax.LineWidth = 1.7;
xlabel('$x_1$','Interpreter','latex','Fontsize',18,'Fontname','Times');
ylabel('$x_2$','Interpreter','latex','Fontsize',18,'Fontname','Times');
xlim([-dom1+1 dom1+1]); ylim([-dom1 dom1+1]); hold on;
set(gca,'LooseInset',get(gca,'TightInset'))
%%
%  Green [54 185 132]/255
%  Red [247 77 77]/255
%  Blue [35 145 213]/255
%  Cyan [121 199 243]/255
%  Grey [133 134 138]/255
