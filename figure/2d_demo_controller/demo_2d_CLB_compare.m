figure(9999);clf;hold on
pcircle(-4,5,2,'k');
pcircle(0,-5,2,'k');
pcircle(5,0,2,'k');
%%
pvar x1 x2 u htol epsi;
x = [x1;x2];
%%
dom1 = 8; domain1 = [-dom1 dom1 -dom1 dom1];
dom2 = 3; domain2 = [-dom2 dom2 -dom2 dom2];
%%%%%%%%%%%%%%%%%%%%%%%
C1 = (x1+4)^2+(x2-5)^2-4;
C2 = (x1+0)^2+(x2+5)^2-4;
C3 = (x1-5)^2+(x2-0)^2-4;
[~,h20] = pcontour(C1,0,domain1,'k'); hold on; h20.LineStyle = '--';     
[~,h21] = pcontour(C2,0,domain1,'k'); hold on; h21.LineStyle = '--';   
[~,h22] = pcontour(C3,0,domain1,'k'); hold on; h22.LineStyle = '--';  
%% Without Controller
% B_no_controller = -0.01730994859216674*x1^4+0.01942272684429362*x1^3*x2+0.03417833273172551*x1^2*x2^2-0.03089576272906369*x1*x2^3-0.03229854756848641*x2^4+0.0469049245134507*x1^3-0.02724130274950444*x1^2*x2-0.1920732549990291*x1*x2^2-0.04355589754110674*x2^3-0.1908212359824433*x1^2+0.04850161666128519*x1*x2-0.3902288519748806*x2^2+0.02342000091755831*x1+0.01847082505198164*x2+0.1049276784359924;
% [~,h28]=pcontour(B_no_controller,0,domain2,'r'); hold on; h28.LineStyle = '-'; h28.LineWidth = 1.4;
%% With controller
V1 = 1*x1^4+2*x2^4+2*x1^2*x2^2+1*x1^2+1*x2^2+1*x1*x2;
sub_level_with_controller = 89.952634023568450;
B_controller_1 = 1.3576759131504796407341473241104*x1*x2^2 - 3.0578816793752339187051347835222*x2 - 1.0488854530197364578469887419487*x1^2*x2^2 - 1.5393659377436941237959899808629*x1*x2 - 2.7790279263382875463150867290096*x1 + 0.99353551144585727783464790263679*x1^2*x2 - 1.0487971515579199710543889523251*x1*x2^3 - 1.0487550290522178464414082554867*x1^3*x2 - 0.59598573150985978408300525188679*x1^2 + 0.12189338665773290226734815178133*x1^3 - 0.4054861188650786818499227592838*x2^2 - 1.0495083410765784215357143693836*x1^4 + 0.77761775628344664834656896346132*x2^3 - 1.0494081234319465600890453060856*x2^4 + 89.818684691415668908121006097645;
%% Fin optimal Lyapunov
optimal_Lya = 0.04375278098272024*x1^4+0.002929993727326272*x1^3*x2-0.009153369646952632*x1^2*x2^2+0.1117128919832005*x1*x2^3+0.1337597502643151*x2^4-0.02068552493110127*x1^3-0.005144335364106218*x1^2*x2-0.06593999449113327*x1*x2^2-0.05150085197129949*x2^3+1.270472041414144*x1^2-0.04520082154572778*x1*x2+2.036327882785228*x2^2+0.0001597265387810012*x1+0.0001773175441663645*x2+18.32229824450674;
optimal_Lya_sub_level_with_controller = 41.61381252856700;
B_controller_2 = 1.4181712489114757236308150822879*x1^2*x2^2 - 1.8820913963902188292820483184187*x2 - 2.8870038830940578655770423210924*x1 - 0.55460632028701661866421090962831*x1*x2 + 0.72550594134539814206164010101929*x1*x2^2 + 0.70266902983011869654461634127074*x1^2*x2 + 0.14890270187894663611594125995907*x1*x2^3 - 0.19104767677853790042163950602117*x1^3*x2 - 1.8762552502905658347032158417278*x1^2 + 0.85342315899248366584117775346385*x1^3 - 1.2937866757217162394510978629114*x2^2 - 0.92670016032137803030366285383934*x1^4 + 0.12794763646276410828939162911411*x2^3 - 0.84451607890692470537175040590228*x2^4 + 77.412530528795983286727278027683;
%%
[~,h31]=pcontour(B_controller_1,0,domain1,'g'); hold on; h31.LineStyle = '-.'; h31.LineWidth = 2.5;
[~,h34]=pcontour(B_controller_2,0,domain1,'b'); h34.LineStyle = '-'; h34.LineWidth = 2.5;
%%
h = legend([h22,h31,h34],{'Unsafe Regions','BC','CBF','Optimal CBF'}, 'Interpreter','latex','location','northeast','Fontsize',12);
set(h,'FontName','Times New Roman','FontSize',14,'FontWeight','normal');hold on;
set(gca,'ytick',[-10,-5,0,5,10]);
set(gca,'xtick',[-10,-5,0,5,10]);
set(gca,'FontSize',14,'Fontname','Times');
set(gca,'Box','on');
ax = gca;
ax.BoxStyle = 'full';
ax.LineWidth = 1.7;
xlabel('$x_1$','Interpreter','latex','Fontsize',18,'Fontname','Times');
ylabel('$x_2$','Interpreter','latex','Fontsize',18,'Fontname','Times');
xlim([-dom1+1 dom1+1]); ylim([-dom1 dom1+1]); hold on;
set(gca,'LooseInset',get(gca,'TightInset'))
%%
%  Green [54 185 132]/255
%  Red [247 77 77]/255
%  Blue [35 145 213]/255
%  Cyan [121 199 243]/255
%  Grey [133 134 138]/255
