sdpvar x1 x2 x3 htol2

dom = 15;
% c1 = (x1+4)^2+(x2-6)^2+(x3+2)^2-4;
c2 = (x1+3)^2+(x2+4)^2+(x3+4)^2-4;
c3 = (x1-4)^2+(x2-0)^2+(x3-0)^2-5;
c4 = (x1+4)^2+(x2-2)^2+(x3-4)^2-5;
%%
f = [-0.16211179709695037165964324641892*x1^4+0.49031898059485488031675707268867*x1^3-0.80741059860165544525334054266171*x1^2-0.67918469453797989758096302163419*x1-0.000031796033448678815965058458425929*x2^4+0.00049811603934539429219124917480599*x2^3-0.017884574789259536503616132563366*x2^2+0.059003602596920091960530641017613*x2+0.14736298331076760903535216584714*x3^4-0.22234685217253638556123007674614*x3^3+0.14008297734444075111071015271591*x3^2+0.34076230832989312657943514750514*x3-1.4865840251194628709408125437986
    -x2*x1^3-x2
    1.876321954439673866943394386908*x1^4-1.8803947547684580765547934788628*x1^3-x1^2*x3-0.3521313244010295662178577913437*x1^2-0.58570314276461321600919518459705*x1+0.0008606977977094753011130801034767*x2^4-0.0047246616639717428295930368165045*x2^3+0.0073970075005580443808228530144788*x2^2-0.39277632595769917944750204696902*x2-0.63399852647351906398398568853736*x3^4-2.3526877462367330462456038731034*x3^3-0.18912599086086179234200699283974*x3^2-1.2624646738177363047839207865763*x3+1.2361363889678920191528277428006
    ];
k_us = 4; k_au = 6; B_degree = 4; k_u = 4; gamma = 0;
    
for i = 1:length(Barrier)
    % B = solh;
    B = Barrier(i);
    solu1 = Control(i,1);
    solu2 = Control(i,2);
    solu3 = Control(i,3);
    [L1 L1c L1v] = polynomial([x1 x2 x3], k_au, 0);
    [L2 L2c L2v] = polynomial([x1 x2 x3], k_au, 0);
    [L3 L3c L3v] = polynomial([x1 x2 x3], k_us, 0);
    [L4 L4c L4v] = polynomial([x1 x2 x3], k_us, 0);
    [L5 L5c L5v] = polynomial([x1 x2 x3], k_us, 0);
    [h hc hv] = polynomial([x1 x2 x3], B_degree, 0);
    %%
    hdot = jacobian(h,x1)*(f(1)+solu1)+jacobian(h,x2)*(f(2)+solu2)+jacobian(h,x3)*(f(3)+solu3);
    %%
    F = [sos(L1),sos(L2),sos(L3),sos(L4),sos(L5),sos(h-L1*B-htol2),sos(hdot+L2*B+gamma*B-htol2),htol2>=0,sos(-h+c2*L3),sos(-h+c3*L4),sos(-h+c4*L5)];
    [sol,vv,QQ] = solvesos(F,-htol2,[],[L1c;L2c;L3c;L4c;L5c;hc;htol2]);
    %%
    solh = value(hc)'*hv;
    sdisplay(solh)
    % smr variables
    figure(2);clf;hold on;
    xran=[-dom dom -dom dom -dom dom];
    hs = char(sdisplay(solh));
    smrplot(hs,0,xran,[300 50],'r-');
    refreshdata; drawnow;
end